
<!DOCTYPE html>
<html lang="ca">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Focus · Proves</title>
<meta name="description" content="Crea proves, publica-les i fes-les per PIN." />
<style>
  :root{--bg:#f7f7fb;--card:#fff;--ink:#0f172a;--muted:#64748b;
    --p1:#7aa2ff;--p2:#22c55e;--bad:#ef4444;--hair:#e5e7eb;
    --shadow:0 12px 28px rgba(15,23,42,.08);--radius:16px}
  *{box-sizing:border-box}body{margin:0;font-family:sans-serif;background:var(--bg);color:var(--ink)}
  header{background:#fff;box-shadow:var(--shadow);padding:10px 16px;position:sticky;top:0}
  nav button{border:none;background:#fff;padding:8px 12px;border-radius:999px;margin:0 4px;cursor:pointer}
  nav button.active{background:var(--p1);color:#fff}
  main{max-width:1100px;margin:20px auto;padding:0 16px}
  .card{background:var(--card);border:1px solid var(--hair);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px;margin-bottom:16px}
  .title{margin:0 0 12px;font-size:18px;font-weight:bold}
  .muted{color:var(--muted);font-size:14px;margin:0 0 12px}
  label{font-weight:600;display:block;margin:10px 0 4px}
  input,textarea,select{width:100%;padding:8px;border:1px solid var(--hair);border-radius:10px;font-size:15px}
  textarea{min-height:60px}
  .btn{border:none;border-radius:10px;padding:8px 12px;font-weight:bold;cursor:pointer}
  .btn.primary{background:var(--p1);color:#fff}
  .btn.good{background:var(--p2);color:#073b14}
  .btn.small{font-size:13px;padding:5px 10px}
  .q-item{border:1px dashed var(--hair);border-radius:10px;padding:10px;margin:10px 0;background:#fafbff}
  .q-head{display:flex;justify-content:space-between;align-items:center}
  .q-type{font-size:13px;font-weight:700}
  table{border-collapse:collapse;width:100%;margin-top:8px}
  th,td{border:1px solid var(--hair);padding:6px;font-size:14px;text-align:left}
  th{background:#f8fafc;font-size:12px}
</style>
</head>
<body>
<header>
  <nav>
    <button id="btnHome" onclick="showView('home')">Inici</button>
    <button id="btnTeacher" onclick="showView('teacher')">Mestre</button>
    <button id="btnStudent" onclick="showView('student')">Alumne</button>
  </nav>
</header>

<main>
  <!-- HOME -->
  <section id="view-home">
    <div class="card">
      <h2 class="title">Benvingut</h2>
      <p class="muted">El mestre crea una prova i el sistema retorna un PIN. Els alumnes introdueixen el PIN per accedir-hi i els resultats es guarden al servidor.</p>
    </div>
  </section>

  <!-- TEACHER -->
  <section id="view-teacher" style="display:none">
    <div class="card">
      <h2 class="title">Creador d’exàmens</h2>
      <label>Títol</label>
      <input id="examTitle" type="text" placeholder="Ex: Equacions 1r Batx"/>
      <label>Instruccions</label>
      <textarea id="examDesc" placeholder="Ex: Respon totes les preguntes."></textarea>

      <div id="questions"></div>
      <button class="btn small" onclick="addQuestion('mc')">+ Opció múltiple</button>
      <button class="btn small" onclick="addQuestion('tf')">+ Vertader/Fals</button>
      <button class="btn small" onclick="addQuestion('short')">+ Resposta curta</button>
      <button class="btn small" onclick="addQuestion('num')">+ Numèrica</button>

      <div style="margin-top:12px">
        <button class="btn good" onclick="publishExam()">Publica</button>
      </div>
      <p id="publishInfo" class="muted"></p>
    </div>

    <div class="card">
      <h3 class="title">Biblioteca d’exàmens</h3>
      <button class="btn small" onclick="loadExamLibrary()">Carrega biblioteca</button>
      <table id="examLibrary"></table>
    </div>
  </section>

  <!-- STUDENT -->
  <section id="view-student" style="display:none">
    <div class="card">
      <h2 class="title">Accés amb PIN</h2>
      <label>PIN</label>
      <input id="pinInput" type="text" placeholder="Ex: 482917"/>
      <button class="btn primary" onclick="loadExamByPin()">Carrega prova</button>
      <div id="examDetails" class="muted"></div>
    </div>
  </section>
</main>

<script>
const API_BASE='';
const $=s=>document.querySelector(s);
function showView(id){
  for(const el of document.querySelectorAll('main>section')) el.style.display='none';
  $('#view-'+id).style.display='';
  document.querySelectorAll('header nav button').forEach(b=>b.classList.remove('active'));
  if(id==='home') $('#btnHome').classList.add('active');
  if(id==='teacher') $('#btnTeacher').classList.add('active');
  if(id==='student') $('#btnStudent').classList.add('active');
}

/* ===== Creador d’examens ===== */
let exam={examId:null,title:'',desc:'',questions:[]};

function addQuestion(type){
  let q={id:Math.random().toString(36).slice(2,8),type,text:'',options:[]};
  if(type==='mc'){q.options=[{text:'Opció 1',correct:false},{text:'Opció 2',correct:true}];}
  if(type==='tf'){q.options=[{text:'Vertader',correct:true},{text:'Fals',correct:false}];}
  exam.questions.push(q); renderQuestions();
}
function renderQuestions(){
  const wrap=$('#questions');wrap.innerHTML='';
  exam.questions.forEach((q,i)=>{
    const div=document.createElement('div');div.className='q-item';
    let opts='';
    if(q.type==='mc'||q.type==='tf'){
      opts=q.options.map((o,j)=>`
        <label><input type="radio" name="c${q.id}" ${o.correct?'checked':''} onchange="setCorrect('${q.id}',${j})"> 
        <input type="text" value="${o.text}" oninput="setOptText('${q.id}',${j},this.value)"></label>`).join('');
    }
    div.innerHTML=`
      <div class="q-head"><span class="q-type">Q${i+1} (${q.type})</span></div>
      <label>Enunciat</label>
      <input type="text" value="${q.text||''}" oninput="setQText('${q.id}',this.value)">
      ${opts}`;
    wrap.appendChild(div);
  });
}
function setQText(id,val){const q=exam.questions.find(x=>x.id===id);if(q)q.text=val;}
function setOptText(id,i,val){const q=exam.questions.find(x=>x.id===id);if(q)q.options[i].text=val;}
function setCorrect(id,i){const q=exam.questions.find(x=>x.id===id);if(q)q.options.forEach((o,j)=>o.correct=j===i);}

async function publishExam(){
  exam.title=$('#examTitle').value.trim();
  exam.desc=$('#examDesc').value.trim();
  if(!exam.title||exam.questions.length===0){alert("Cal títol i preguntes");return;}
  const res=await fetch(API_BASE+'/api/exams',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(exam)});
  const data=await res.json();
  exam.examId=data.examId;
  $('#publishInfo').innerHTML=`Publicat! PIN <b>${data.pin}</b> · examId <span class="mono">${data.examId}</span>`;
}

/* ===== Biblioteca ===== */
async function loadExamLibrary(){
  const res=await fetch(API_BASE+'/api/exams');
  const exams=await res.json();
  let rows='<tr><th>PIN</th><th>examId</th><th>Títol</th></tr>';
  exams.forEach(e=>{rows+=`<tr><td>${e.pin}</td><td class="mono">${e.examId}</td><td>${e.title}</td></tr>`});
  $('#examLibrary').innerHTML=rows;
}

/* ===== Alumne ===== */
let loadedExam=null;
async function loadExamByPin(){
  const pin=$('#pinInput').value.trim();
  const res=await fetch(API_BASE+'/api/exams/pin/'+encodeURIComponent(pin));
  if(!res.ok){alert("PIN no trobat");return;}
  const data=await res.json();
  loadedExam=data;
  $('#examDetails').innerHTML=`<b>${data.title}</b><br>examId: <span class="mono">${data.examId}</span>`;
}
</script>
</body>
</html>